<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>{% if page.title %}{{ page.title }} - {{ t.site_title }}{% else %}{{ t.site_title }}{% endif %}</title>
    <meta name="description" content="{% if page.excerpt %}{{ page.excerpt }}{% else %}{{ t.description }}{% endif %}">
    
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="canonical" href="{{ site.url }}{{ page.url | default(value="") }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#D34516">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Incredible Rust">
    <link rel="apple-touch-icon" href="/assets/favicon.svg">
    
    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
</head>

<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <header class="site-header">
            <div class="wrapper">
                {% if lang == "en" %}
                    <a class="site-title" href="/">
                        <span class="rust-logo">ðŸ¦€</span>
                        {{ t.site_title | default(value="The Incredible Rust") }}
                    </a>
                {% elif lang == "pt" %}
                    <a class="site-title" href="/pt/">
                        <span class="rust-logo">ðŸ¦€</span>
                        {{ t.site_title | default(value="O IncrÃ­vel Rust") }}
                    </a>
                {% elif lang == "es" %}
                    <a class="site-title" href="/es/">
                        <span class="rust-logo">ðŸ¦€</span>
                        {{ t.site_title | default(value="El IncreÃ­ble Rust") }}
                    </a>
                {% endif %}
                
                <nav class="site-nav">
                    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
                    <label for="nav-trigger">
                        <span class="menu-icon">
                            <svg viewBox="0 0 18 15" width="18px" height="15px">
                                <path fill="#424242" d="m18,1.484c0,0.82-0.665,1.484-1.484,1.484h-15.031c-0.82,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.031c0.82,0,1.484,0.665,1.484,1.484zm0,5.515c0,0.82-0.665,1.484-1.484,1.484h-15.031c-0.82,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.031c0.82,0,1.484,0.665,1.484,1.484zm0,5.515c0,0.82-0.665,1.484-1.484,1.484h-15.031c-0.82,0-1.484-0.665-1.484-1.484s0.665-1.484,1.484-1.484h15.031c0.82,0,1.484,0.665,1.484,1.484z"/>
                            </svg>
                        </span>
                    </label>
                    
                    <div class="trigger">
                        {% if lang == "en" %}
                            <a class="page-link" href="/lessons/">{{ t.nav.lessons | default(value="Lessons") }}</a>
                            <a class="page-link" href="/about/">{{ t.nav.about | default(value="About") }}</a>
                        {% elif lang == "pt" %}
                            <a class="page-link" href="/pt/lessons/">{{ t.nav.lessons | default(value="LiÃ§Ãµes") }}</a>
                            <a class="page-link" href="/pt/about/">{{ t.nav.about | default(value="Sobre") }}</a>
                        {% elif lang == "es" %}
                            <a class="page-link" href="/es/lessons/">{{ t.nav.lessons | default(value="Lecciones") }}</a>
                            <a class="page-link" href="/es/about/">{{ t.nav.about | default(value="Acerca de") }}</a>
                        {% endif %}
                        <a class="page-link" href="https://github.com/incrediblerust/incrediblerust.github.io" target="_blank">GitHub</a>
                        
                        <!-- Modern Language Switcher -->
                        <div class="language-switcher">
                            <button class="lang-button" onclick="toggleLanguageMenu()" aria-label="Selecionar Idioma" aria-expanded="false">
                                <span class="lang-flag">
                                    {% if lang == "en" %}ðŸ‡ºðŸ‡¸{% elif lang == "pt" %}ðŸ‡§ðŸ‡·{% elif lang == "es" %}ðŸ‡ªðŸ‡¸{% else %}ðŸ‡ºðŸ‡¸{% endif %}
                                </span>
                                <span class="lang-text">
                                    {% if lang == "en" %}English{% elif lang == "pt" %}PortuguÃªs{% elif lang == "es" %}EspaÃ±ol{% else %}English{% endif %}
                                </span>
                                <svg class="lang-arrow" width="12" height="8" viewBox="0 0 12 8" fill="none">
                                    <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="lang-menu" id="langMenu" role="menu">
                                <a href="/" class="lang-option {% if lang == 'en' %}active{% endif %}" role="menuitem">
                                    <span class="lang-flag">ðŸ‡ºðŸ‡¸</span>
                                    <span class="lang-details">
                                        <span class="lang-name">English</span>
                                        <span class="lang-native">English</span>
                                    </span>
                                </a>
                                <a href="/pt/" class="lang-option {% if lang == 'pt' %}active{% endif %}" role="menuitem">
                                    <span class="lang-flag">ðŸ‡§ðŸ‡·</span>
                                    <span class="lang-details">
                                        <span class="lang-name">PortuguÃªs</span>
                                        <span class="lang-native">PortuguÃªs (Brasil)</span>
                                    </span>
                                </a>
                                <a href="/es/" class="lang-option {% if lang == 'es' %}active{% endif %}" role="menuitem">
                                    <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
                                    <span class="lang-details">
                                        <span class="lang-name">EspaÃ±ol</span>
                                        <span class="lang-native">EspaÃ±ol</span>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <main class="page-content" aria-label="Content" id="main-content">
            <div class="wrapper">
                {% block content %}{% endblock content %}
            </div>
        </main>

        <footer class="site-footer">
            <div class="wrapper">
                <div class="footer-col-wrapper">
                    <div class="footer-col footer-col-1">
                        <ul class="contact-list">
                            <li>{{ site.title | default(value="The Incredible Rust") }}</li>
                        </ul>
                    </div>
                    
                    <div class="footer-col footer-col-2">
                        <ul class="social-media-list">
                            <li><a href="https://github.com/incrediblerust" target="_blank">GitHub</a></li>
                            <li><a href="https://doc.rust-lang.org/" target="_blank">Rust Documentation</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-col footer-col-3">
                        <p>{{ site.description | default(value="Learn Rust Programming") }}</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        function toggleLanguageMenu() {
            const menu = document.getElementById('langMenu');
            const button = document.querySelector('.lang-button');
            const arrow = document.querySelector('.lang-arrow');
            const isOpen = menu.classList.contains('show');
            
            if (isOpen) {
                closeLanguageMenu();
            } else {
                openLanguageMenu();
            }
        }
        
        function openLanguageMenu() {
            const menu = document.getElementById('langMenu');
            const button = document.querySelector('.lang-button');
            const arrow = document.querySelector('.lang-arrow');
            
            menu.classList.add('show');
            button.setAttribute('aria-expanded', 'true');
            arrow.style.transform = 'rotate(180deg)';
            
            // Focus first menu item for accessibility
            const firstOption = menu.querySelector('.lang-option');
            if (firstOption) {
                firstOption.focus();
            }
        }
        
        function closeLanguageMenu() {
            const menu = document.getElementById('langMenu');
            const button = document.querySelector('.lang-button');
            const arrow = document.querySelector('.lang-arrow');
            
            menu.classList.remove('show');
            button.setAttribute('aria-expanded', 'false');
            arrow.style.transform = 'rotate(0deg)';
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const switcher = document.querySelector('.language-switcher');
            const menu = document.getElementById('langMenu');
            
            if (!switcher.contains(event.target) && menu.classList.contains('show')) {
                closeLanguageMenu();
            }
        });
        
        // Keyboard navigation for accessibility
        document.addEventListener('keydown', function(event) {
            const menu = document.getElementById('langMenu');
            const button = document.querySelector('.lang-button');
            
            if (!menu.classList.contains('show')) return;
            
            const menuItems = menu.querySelectorAll('.lang-option');
            const currentFocus = document.activeElement;
            const currentIndex = Array.from(menuItems).indexOf(currentFocus);
            
            switch(event.key) {
                case 'Escape':
                    closeLanguageMenu();
                    button.focus();
                    event.preventDefault();
                    break;
                case 'ArrowDown':
                    const nextIndex = currentIndex < menuItems.length - 1 ? currentIndex + 1 : 0;
                    menuItems[nextIndex].focus();
                    event.preventDefault();
                    break;
                case 'ArrowUp':
                    const prevIndex = currentIndex > 0 ? currentIndex - 1 : menuItems.length - 1;
                    menuItems[prevIndex].focus();
                    event.preventDefault();
                    break;
                case 'Tab':
                    if (event.shiftKey && currentIndex === 0) {
                        closeLanguageMenu();
                        button.focus();
                        event.preventDefault();
                    } else if (!event.shiftKey && currentIndex === menuItems.length - 1) {
                        closeLanguageMenu();
                        event.preventDefault();
                    }
                    break;
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>